<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  </head>
  <body>
    <div id="container">
      <div id="title">Penn Course LMK</div>
    </div>
    <form action="/submitted" method="POST">
      <input type="text" placeholder="email" id="email" name="email">
      <div id="bloodhound"><input type="text" class="typeahead" placeholder="course" id="course" name="course"></div>
      <input type="text" placeholder="phone number" id="phonenumber" name="phonenumber">
      <select id="carrier" name="carrier">
        <option value="Verizon">Verizon</option>
        <option value="AT&T">AT&amp;T</option>
        <option value="T-Mobile">T-Mobile</option>
        <option value="Sprint">Sprint</option>
        <option value="USCellular">US Cellular</option>
      </select><br>
      <input type="checkbox" placeholder="notifications" id="notifications" name="notifications">Perpetual Notifications<br>
      <button type="submit">Submit</button>
    </form>
    <script type="text/javascript" src="/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/typeahead.bundle.js"></script>
    <script type="text/javascript" src="/searchbar.js"></script>
    <script>
      // on submission of form, update local storage to remember user's data
      $('form').submit(function(e) {
        localStorage.setItem('lmkEmail', e.target.email.value);
        localStorage.setItem('lmkPhone', e.target.phonenumber.value);
        localStorage.setItem('lmkCarrier', e.target.carrier.value);
      });

      // parses form info out of link
      function parseURL(url) {
        let formInfo = {};
        const linkData = url.replace(/.*\?/, '').split('&');
        for (let i = 0; i < linkData.length; i++ ) {
            let split = linkData[i].split('=');
            formInfo[split[0]] = split[1];
        }
        return formInfo;
      }

      // if URL contains '?', then pre-populate form from parsed URL
      if (window.location.href.includes('?')) {
        const info = parseURL(window.location.href);
        $('#email').val(info.email);
        $('#course').val(info.course);
        $('#phonenumber').val(info.phonenumber);
        $('#notifications').prop('checked', info.notifications);
        $('#carrier').val(info.carrier);
      }
      // otherwise, pre-populate form from local storage
      else {
        $('#email').val(localStorage.getItem('lmkEmail'));
        $('#phonenumber').val(localStorage.getItem('lmkPhone'));
        $('#carrier').val(localStorage.getItem('lmkCarrier'));
      }
    </script>
  </body>
</html>